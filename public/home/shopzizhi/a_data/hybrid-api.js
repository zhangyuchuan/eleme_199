!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hybridAPI=t()}(this,function(){"use strict";var e,t=function(){var e=navigator.userAgent||navigator.vendor;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"Unknown"},n=/eleme/i.test(navigator.userAgent),r={},o=t(),i=function(e){if("android"!==e.toLowerCase())return!1;var t=navigator.userAgent||navigator.vendor,n=/eleme\/(\d+(\.\d+){1,2})/i.exec(t);if(null!=n&&n.length>2){var r=n[1].split(".");if(r[0]>7)return!0;if(7==r[0]&&r[1]>=18)return!0}return!1}(o),a={},c=1,u=[],s=function(t,n,a){if(n){var s="cb_"+c+++"_"+(new Date).getTime();r[s]=n,t.callbackId=s}if("iOS"===o)u.push(t),e.src="elmscheme://__ELM_QUEUE_MESSAGE__";else if(i)t.type=a,u.push(t),e.src="elemejsbridge://__ELM_QUEUE_MESSAGE__";else{u.push(t);var d=JSON.stringify(u);e.src="elemejsbridge://return/"+a+"/"+encodeURIComponent(d),u=[]}},d=function(e){var t,n,o=JSON.parse(e);if(o.responseId)"function"==typeof(t=r[o.responseId])&&t(o.responseData||o.data);else{if(o.callbackId){var i=o.callbackId;t=function(e){s({responseId:i,data:e},null,"_response")}}var c=WebViewJavascriptBridge._messageHandler;o.handlerName&&(n=o.handlerName,c=a[n]);try{c(o.data,t)}catch(e){console.log("WebViewJavascriptBridge: WARNING: javascript handler throw.",o,e)}}},g=[],l=function(e){g?g.push(e):d(e)},f=!1,m=function(e){if(f)throw new Error("WebViewJavascriptBridge.init called twice");if(window.WebViewJavascriptBridge&&(window.WebViewJavascriptBridge._messageHandler=e,f=!0,g)){for(var t=0;t<g.length;t++)d(g[t]);g=null}},v=function(e,t){void 0===t&&(t=[]);var n=window[e]={};t.forEach(function(t){t=t.replace(new RegExp(":","g"),""),n[t]=function(n,r){!function(e,t,n,r){var o={obj:e,method:t};void 0!==n&&null!==n&&(o.data=n),s(o,r,"_interface")}(e,t,n,r)}})},h=function(){};h.init=m,h.inject=v,h.injectEvent=function(){var e=document.createEvent("Events");e.initEvent("WebViewJavascriptBridgeInjectFinishedReady",!0,!0),document.dispatchEvent(e)},h.registerHandler=function(e,t){a[e]=t},h.callHandler=function(e,t,n){s({handlerName:e,data:t},n,"_handler")};var p,w,_=t();"iOS"===_?(h._fetchQueue=function(){var e=JSON.stringify(u);return u=[],e},h._handleMessageFromObjC=l):"Android"===_?(h._fetchQueue=function(){for(var t,n="elemejsbridge://return",r=0;r<u.length;r++){n=n+"/"+(t=u[r]).type,delete t.type;var o=JSON.stringify([t]);n=n+"/"+encodeURIComponent(o)}e.src=n},h._handleMessageFromNative=l):console.warn("Error: "+_+" is not supported."),window.WebViewJavascriptBridge=h,n&&((e=document.createElement("iframe")).style.display="none","iOS"===o&&(e.src="elmscheme://__ELM_QUEUE_MESSAGE__"),document.documentElement.appendChild(e),p=h,(w=document.createEvent("Events")).initEvent("WebViewJavascriptBridgeReady",!0,!0),w.bridge=p,document.dispatchEvent(w),m());var P=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},b=function(e,t){return!(!t&&!(t=(window.navigator.userAgent.match(/Eleme\/([\d|\.]+)/i)||[])[1]))&&(e=e.split("."),t=t.split("."),e.forEach(function(e,r){var o=t[r];if(void 0===o&&(o=0),void 0===n){var i=Number(e)-Number(o);0!==i&&(n=i>0)}}),!!n);var n},y=function(e,t,n){if(/eleme/i.test(navigator.userAgent))return new Promise(function(r,o){var i=[t,n||r],a=window.EJsBridge[e];if(!a)throw new Error("EJsBridge don't has api named: "+e);a.apply(window.EJsBridge,i)});console.log("Run eleme jsbridge in eleme app please.")},E=function(e){return Number.isNaN(+e)?0:e.getTime()/1e3},I="function"==typeof Object.assign?Object.assign:function(e){var t=arguments;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=t[r];if(void 0!==o&&null!==o)for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])}return n},C=Object.create(null),R=function(e,t){document[e+"EventListener"](t,C[t],!1)},k=Object.create(null),L=function(e,t){document[e+"EventListener"](t,k[t],!1)},S=function(){if(!/Android/i.test(navigator.userAgent))return!1;var e=(navigator.userAgent.match(/Eleme\/([\d|\.]+)/i)||[])[1];return!e||"7.9"===e||"7.9.1"===e};var N=~~document.querySelector("html").getAttribute("data-dpr")||1,O=window.devicePixelRatio||1,A=function(e){return void 0===e&&(e=0),~~(e*N/O)},B=function(e){return void 0===e&&(e={}),{status_bar:A(e.status_bar),nav_bar:A(e.nav_bar||e.default_nav_bar)}};var x=function(e){return"string"==typeof e?{solid:e}:e},T=function(e,t){void 0===t&&(t={}),!0===e&&y("setNavBgColor",I({from:"#00ffffff",to:"#00aaff,#0085ff"},t))};var U={getAll:function(e){return y("getAllCarts",e)},get:function(e){return y("getCartItems",e)},reduce:function(e){return void 0===e&&(e={}),y("reduceCartItem",e)},remove:function(e){return void 0===e&&(e={}),y("removeCartItem",e)},add:function(e){return void 0===e&&(e={}),y("addCartItem",e)},clear:function(e){return y("clearCart",e)}},j={createEvent:function(e){var t=e.start,n=e.end,r=e.alarms,o=e.repeat,i=e.notes,a=e.url,c=e.title,u=e.allday,s=r.map(function(e){var t=E(e.date);return I({},e,{date:t})}),d=E(o.end_date),g=I({},o,{endDate:d}),l={start:E(t),end:E(n),alarms:s,repeat:g,notes:i,url:a,title:c,allday:u};return new Promise(function(e,t){y("handleCalendarEvent",l).then(function(n){var r=n.eventIdentifier;return r?e({id:r,response:n}):t(n)})})},openEvent:function(e){return new Promise(function(t,n){if(!e)return n(new Error("参数：'id'为必填。"));y("handleCalendarEvent",{eventIdentifier:e}).then(t).catch(n)})}},H={getDevice:function(){return y("getDevice")},getCuid:function(){return y("getCuid")},getAppVersion:function(){return y("getAppVersion")},getChannel:function(){return y("getChannel")},getScreenWidth:function(){return y("getScreenWidth")},getScreenHeight:function(){return y("getScreenHeight")},getFrom:function(){return y("getFrom")},getOsVersion:function(){return y("getOsVersion")},getModel:function(){return y("getModel")}},M={getSyncLocation:function(){return y("getSyncLocation")},getAddress:function(){return y("getAddress")},getCityId:function(){return y("getCityId")},getLocLng:function(){return y("getLocLng")},getLocLat:function(){return y("getLocLat")},getLng:function(){return y("getLng")},getLat:function(){return y("getLat")}},J={notifyPageObserver:function(e){return void 0===e&&(e={}),y("notifyPageObserver",e)},addPageObserver:function(e,t){return void 0===e&&(e={}),y("addPageObserver",e,t)}},D={openPageRefresh:function(){return y("openPageRefresh")},closePageRefresh:function(){return y("closePageRefresh")},hidePageRefresh:function(){return y("hidePageRefresh")},setPageAction:function(e,t){return void 0===e&&(e=""),y("setPageAction",e,t)}};return/eleme/i.test(navigator.userAgent)&&v("EJsBridge",["getGlobalGeohash","showShareButton","selectedHongbao","selectHongbao","selectCoupon","getLocateStatus","setTitle","closePage","getUserID","showRightBarItems","removeRightBarItems","hookGoback","shouldShowNewRetailRedBadge","networkType","exitConfirm","checkPackages","openPackage","defaultHeightOfTopBar","contactList","setImmersiveMode","setLightStatusBar","setNavBgColor","setNavTextColor","setTriggerHeight","scanCode","getCartItems","addCartItem","reduceCartItem","removeCartItem","clearCart","getAllCarts","getDevice","getCuid","getAppVersion","getChannel","getScreenWidth","getScreenHeight","getFrom","getOsVersion","getModel","getSyncLocation","getAddress","getCityId","getLocLng","getLocLat","getLng","getLat","getLocMapImage","getNetwork","fetch","notifyPageObserver","addPageObserver","changePageForResult","setPageForResult","openPageRefresh","closePageRefresh","hidePageRefresh","setPageAction","getPageData","takePhoto","toast","dialog","loading","setBounces","cheatInfo","localPush","handleCalendarEvent"]),I({getGlobalGeohash:function(){return y("getGlobalGeohash")},getLocateStatus:function(){return y("getLocateStatus")},share:function(e){document.head.insertAdjacentHTML("afterbegin",'\n      <meta name="eleme-share">\n      <meta name="eleme-share:title" content="'+e.title+'">\n      <meta name="eleme-share:description" content="'+e.text+'">\n      <meta name="eleme-share:image" content="'+encodeURI(decodeURI(e.image_url))+'">')},selectHongbao:function(e){return y("selectHongbao",e,null)},selectCoupon:function(e){return y("selectCoupon",String(e))},networkType:function(){return y("networkType")},setTitle:function(e){return document.title=e,y("setTitle",e)},closePage:function(){return y("closePage")},exitConfirm:function(e){return y("exitConfirm",e)},getUserID:function(e){return y("getUserID")},checkPackages:function(e){return y("checkPackages")},openPackage:function(e){return y("openPackage",e)},scanCode:function(e){return void 0===e&&(e={}),y("scanCode",e)},setRightMenu:function(e){var t=[];return e.forEach(function(e){var n=e.eventName;"function"==typeof C[n]&&R("remove",n),C[n]=function(){setTimeout(e.action,0)},R("add",n),t.push({title:e.text,iconHash:e.iconHash,overflow:!!e.overflow,eventName:n})}),y("showRightBarItems",t)},clearRightMenu:function(){return Object.keys(C).forEach(function(e){R("remove",e),delete C[e]}),y("removeRightBarItems")},hookBack:function(e){var t=e.eventName,n=e.action;if("function"==typeof n)return"function"==typeof k[t]&&L("remove",t),k[t]=function(e){setTimeout(function(){n(e&&e.detail)},0)},L("add",t),y("hookGoback",t)},cancelHookBack:function(){return Object.keys(k).forEach(function(e){L("remove",e),delete k[e]}),y("hookGoback",null)},shouldShowNewRetailRedBadge:function(){return y("shouldShowNewRetailRedBadge")},pay:function(e){return new Promise(function(t,n){(!/eleme/i.test(navigator.userAgent)||b("7.8")||S())&&n({name:"NOT_SUPPORT"});var r=e.eventName,o=(e.action,e.merchantId),i=e.merchantOrderNo,a=e.xShard;r=r||"NATIVE_PAY_CALLBACk",document.addEventListener(r,function(e){var r=e.detail,o={};o.merchantId=r.merchant_id,o.merchantOrderNo=r.merchant_order_no,o.status=r.status,"success"===r.status?t(o):n({name:r.status.toUpperCase(),data:o})},!1);var c="merchant_id="+o+"&merchant_order_no="+i+"&event_name="+r,u="eleme://pay?"+c+"&return_url="+encodeURIComponent("eleme://web_pay_result?"+c);a&&(u+="&x_shard="+a),location.href=u})},getTopBarHeight:function(){return y("defaultHeightOfTopBar").then(B)},contactList:function(e){return new Promise(function(t,n){if(/Android/i.test(navigator.userAgent))return n({name:"NOT_SUPPORT"});y("contactList",e).then(function(e){"string"==typeof e?n({name:"PERMISSION_DENIED",data:e}):t(e)})})},setNav:function(e){var t=e.immersive,n=e.statusText,r=e.navBg,o=e.navText,i=e.triggerHeight;return void 0!==t&&(y("setImmersiveMode",t),T(t,r)),void 0!==n&&y("setLightStatusBar",{solid:"white"===n}),void 0!==r&&y("setNavBgColor",x(r)),void 0!==o&&y("setNavTextColor",x(o)),void 0!==i&&y("setTriggerHeight",i),new Promise(function(e){e()})},sharePanel:function(e){var t={weixin:{key:"weixin_session",value:0},weixin_timeline:{key:"weixin_timeline",value:1},weibo:{key:"weibo",value:2},qq:{key:"qq_session",value:4},qzone:{key:"qzone_session",value:5},weapp:{key:"weapp",value:7}},n={source:"",title:"饿了么",text:"",url:location.href,media:"",targets:Object.keys(t)},r={},o=(e=I(n,e)).url+(/\?|#/.test(e.url)?"&":"?"),i=e.targets.indexOf("clipboard");return-1!==i&&(r.clipboard="eleme://copy?text="+encodeURIComponent(e.url),e.targets.splice(i,1)),e.targets.forEach(function(n){var i=t[n];r[i.key]="eleme://share?"+P({type:i.value,title:e.title,text:e.text,url:o+"type="+n,image_url:encodeURI(decodeURI(e.image_url)),image_only:e.image_only?1:0,media:e.media}),"weapp"===n&&(r[i.key]="eleme://share?"+P({type:7,weapp_id:e.weapp_id,path:e.weapp_path,title:e.title,image_url:e.image_url,url:e.url||""}))}),e.weixin_timeline_image&&(r.weixin_timeline="eleme://share?"+P({type:1,image_url:encodeURI(decodeURI(e.weixin_timeline_image)),image_only:1})),location.href="eleme://sns_share?source="+e.source+"&"+P(r),Promise.resolve()},cart:U,localPush:function(e){var t=e.trigger_at,n=e.title,r=e.content,o=e.icon_base64,i=e.scheme;return new Promise(function(e,a){if(void 0===n)return a(new Error("属性：'title' 不能为空。"));if(void 0===t)return a(new Error("属性：'trigger_at' 不能为空。"));var c=E(t);if(c<E(new Date))return a(new Error("属性：'trigger_at'时间不能小于当前时间。"));y("localPush",{trigger_at:c,title:n,content:r,icon_base64:o,scheme:i}).then(function(t){t?e():a(new Error("可能未开启权限或者参数传送不成功。"))})})},calendar:j,getLocMapImage:function(e){return void 0===e&&(e={}),y("getLocMapImage",e)},getNetwork:function(){return y("getNetwork")},fetch:function(e){return void 0===e&&(e={}),y("fetch",e)},changePageForResult:function(e,t){return void 0===e&&(e={}),y("changePageForResult",e,t)},setPageForResult:function(e){return void 0===e&&(e={}),y("setPageForResult",e)},getPageData:function(){return y("getPageData")},takePhoto:function(e){var t=e.width,n=e.height;return y("takePhoto",{width:t,height:n})},toast:function(e){return void 0===e&&(e={}),y("toast",e)},dialog:function(e){return void 0===e&&(e={}),new Promise(function(t,n){return y("dialog",e).then(function(e){1==e.status?t(e):n(e)})})},loading:function(e){return void 0===e&&(e={}),y("loading",e)},setBounces:function(e){return y("setBounces",e)},cheatInfo:function(){return y("cheatInfo")}},H,M,J,D)});