!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hybridAPI=t()}(this,function(){"use strict";var e,t=function(){var e=navigator.userAgent||navigator.vendor;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"Unknown"},n=/eleme/i.test(navigator.userAgent),r={},i=t(),o=function(e){if("android"!==e.toLowerCase())return!1;var t=navigator.userAgent||navigator.vendor,n=/eleme\/(\d+(\.\d+){1,2})/i.exec(t);if(null!=n&&n.length>2){var r=n[1].split(".");if(r[0]>7)return!0;if(7==r[0]&&r[1]>=18)return!0}return!1}(i),a={},c=1,u=[],s=function(t,n,a){if(n){var s="cb_"+c+++"_"+(new Date).getTime();r[s]=n,t.callbackId=s}if("iOS"===i)u.push(t),e.src="elmscheme://__ELM_QUEUE_MESSAGE__";else if(o)t.type=a,u.push(t),e.src="elemejsbridge://__ELM_QUEUE_MESSAGE__";else{u.push(t);var f=JSON.stringify(u);e.src="elemejsbridge://return/"+a+"/"+encodeURIComponent(f),u=[]}},f=function(e){var t,n,i=JSON.parse(e);if(i.responseId)"function"==typeof(t=r[i.responseId])&&t(i.responseData||i.data);else{if(i.callbackId){var o=i.callbackId;t=function(e){s({responseId:o,data:e},null,"_response")}}var c=WebViewJavascriptBridge._messageHandler;i.handlerName&&(n=i.handlerName,c=a[n]);try{c(i.data,t)}catch(e){console.log("WebViewJavascriptBridge: WARNING: javascript handler throw.",i,e)}}},d=[],g=function(e){d?d.push(e):f(e)},l=!1,v=function(e){if(l)throw new Error("WebViewJavascriptBridge.init called twice");if(window.WebViewJavascriptBridge&&(window.WebViewJavascriptBridge._messageHandler=e,l=!0,d)){for(var t=0;t<d.length;t++)f(d[t]);d=null}},m=function(e,t){void 0===t&&(t=[]);var n=window[e]={};t.forEach(function(t){t=t.replace(new RegExp(":","g"),""),n[t]=function(n,r){!function(e,t,n,r){var i={obj:e,method:t};void 0!==n&&null!==n&&(i.data=n),s(i,r,"_interface")}(e,t,n,r)}})},h=function(){};h.init=v,h.inject=m,h.injectEvent=function(){var e=document.createEvent("Events");e.initEvent("WebViewJavascriptBridgeInjectFinishedReady",!0,!0),document.dispatchEvent(e)},h.registerHandler=function(e,t){a[e]=t},h.callHandler=function(e,t,n){s({handlerName:e,data:t},n,"_handler")};var p,w,_=t();"iOS"===_?(h._fetchQueue=function(){var e=JSON.stringify(u);return u=[],e},h._handleMessageFromObjC=g):"Android"===_?(h._fetchQueue=function(){for(var t,n="elemejsbridge://return",r=0;r<u.length;r++){n=n+"/"+(t=u[r]).type,delete t.type;var i=JSON.stringify([t]);n=n+"/"+encodeURIComponent(i)}e.src=n},h._handleMessageFromNative=g):console.warn("Error: "+_+" is not supported."),window.WebViewJavascriptBridge=h,n&&((e=document.createElement("iframe")).style.display="none","iOS"===i&&(e.src="elmscheme://__ELM_QUEUE_MESSAGE__"),document.documentElement.appendChild(e),p=h,(w=document.createEvent("Events")).initEvent("WebViewJavascriptBridgeReady",!0,!0),w.bridge=p,document.dispatchEvent(w),v());var y=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},P=function(e,t){return!(!t&&!(t=(window.navigator.userAgent.match(/Eleme\/([\d|\.]+)/i)||[])[1]))&&(e=e.split("."),t=t.split("."),e.forEach(function(e,r){var i=t[r];if(void 0===i&&(i=0),void 0===n){var o=Number(e)-Number(i);0!==o&&(n=o>0)}}),!!n);var n},b=function(e,t,n){if(/eleme/i.test(navigator.userAgent))return new Promise(function(r,i){var o=[t,n||r],a=window.EJsBridge[e];if(!a)throw new Error("EJsBridge don't has api named: "+e);a.apply(window.EJsBridge,o)});console.log("Run eleme jsbridge in eleme app please.")},E=function(e){return Number.isNaN(+e)?0:e.getTime()/1e3},I="function"==typeof Object.assign?Object.assign:function(e){var t=arguments;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=t[r];if(void 0!==i&&null!==i)for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])}return n},C=Object.create(null),R=function(e,t){document[e+"EventListener"](t,C[t],!1)},k=Object.create(null),L=function(e,t){document[e+"EventListener"](t,k[t],!1)},O=function(){if(!/Android/i.test(navigator.userAgent))return!1;var e=(navigator.userAgent.match(/Eleme\/([\d|\.]+)/i)||[])[1];return!e||"7.9"===e||"7.9.1"===e};var S=~~document.querySelector("html").getAttribute("data-dpr")||1,x=window.devicePixelRatio||1,A=function(e){return void 0===e&&(e=0),~~(e*S/x)},B=function(e){return void 0===e&&(e={}),{status_bar:A(e.status_bar),nav_bar:A(e.nav_bar||e.default_nav_bar)}};var N="#00aaff,#0085ff",T={0:{immersive:!1,statusText:"white",navBg:N,navText:"#ffffff",triggerHeight:1},1:{immersive:!0,statusText:"white",navBg:"#00ffffff",navText:"#ffffff",triggerHeight:1},2:{immersive:!0,statusText:"white",navText:"#ffffff",triggerHeight:1},3:{immersive:!0,statusText:"white",navBg:"#00ffffff",navText:"#00ffffff",triggerHeight:1},4:{immersive:!0,statusText:"white",navText:{from:"#00ffffff",to:"#ffffff"},triggerHeight:1}},H=function(e){return"string"==typeof e?{solid:e}:e};var U={getAll:function(e){return b("getAllCarts",e)},get:function(e){return b("getCartItems",e)},reduce:function(e){return void 0===e&&(e={}),b("reduceCartItem",e)},remove:function(e){return void 0===e&&(e={}),b("removeCartItem",e)},add:function(e){return void 0===e&&(e={}),b("addCartItem",e)},clear:function(e){return b("clearCart",e)}},j={createEvent:function(e){var t=e.start,n=e.end,r=e.alarms,i=e.repeat,o=e.notes,a=e.url,c=e.title,u=e.allday,s=r.map(function(e){var t=E(e.date);return I({},e,{date:t})}),f=E(i.end_date),d=I({},i,{endDate:f}),g={start:E(t),end:E(n),alarms:s,repeat:d,notes:o,url:a,title:c,allday:u};return new Promise(function(e,t){b("handleCalendarEvent",g).then(function(n){var r=n.eventIdentifier;return r?e({id:r,response:n}):t(n)})})},openEvent:function(e){return new Promise(function(t,n){if(!e)return n(new Error("参数：'id'为必填。"));b("handleCalendarEvent",{eventIdentifier:e}).then(t).catch(n)})}},M={getDevice:function(){return b("getDevice")},getCuid:function(){return b("getCuid")},getAppVersion:function(){return b("getAppVersion")},getChannel:function(){return b("getChannel")},getScreenWidth:function(){return b("getScreenWidth")},getScreenHeight:function(){return b("getScreenHeight")},getFrom:function(){return b("getFrom")},getOsVersion:function(){return b("getOsVersion")},getModel:function(){return b("getModel")}},J={getSyncLocation:function(){return b("getSyncLocation")},getAddress:function(){return b("getAddress")},getCityId:function(){return b("getCityId")},getLocLng:function(){return b("getLocLng")},getLocLat:function(){return b("getLocLat")},getLng:function(){return b("getLng")},getLat:function(){return b("getLat")}},D={notifyPageObserver:function(e){return void 0===e&&(e={}),b("notifyPageObserver",e)},addPageObserver:function(e,t){return void 0===e&&(e={}),b("addPageObserver",e,t)}},V={openPageRefresh:function(){return b("openPageRefresh")},closePageRefresh:function(){return b("closePageRefresh")},hidePageRefresh:function(){return b("hidePageRefresh")},setPageAction:function(e,t){return void 0===e&&(e=""),b("setPageAction",e,t)}};return/eleme/i.test(navigator.userAgent)&&m("EJsBridge",["getGlobalGeohash","showShareButton","selectedHongbao","selectHongbao","selectCoupon","getLocateStatus","setTitle","closePage","getUserID","showRightBarItems","removeRightBarItems","hookGoback","shouldShowNewRetailRedBadge","networkType","exitConfirm","checkPackages","openPackage","defaultHeightOfTopBar","contactList","setImmersiveMode","setLightStatusBar","setNavBgColor","setNavTextColor","setTriggerHeight","scanCode","getCartItems","addCartItem","reduceCartItem","removeCartItem","clearCart","getAllCarts","getDevice","getCuid","getAppVersion","getChannel","getScreenWidth","getScreenHeight","getFrom","getOsVersion","getModel","getSyncLocation","getAddress","getCityId","getLocLng","getLocLat","getLng","getLat","getLocMapImage","getNetwork","fetch","notifyPageObserver","addPageObserver","changePageForResult","setPageForResult","openPageRefresh","closePageRefresh","hidePageRefresh","setPageAction","getPageData","takePhoto","toast","dialog","loading","setBounces","cheatInfo","localPush","handleCalendarEvent"]),I({getGlobalGeohash:function(){return b("getGlobalGeohash")},getLocateStatus:function(){return b("getLocateStatus")},share:function(e){document.head.insertAdjacentHTML("afterbegin",'\n      <meta name="eleme-share">\n      <meta name="eleme-share:title" content="'+e.title+'">\n      <meta name="eleme-share:description" content="'+e.text+'">\n      <meta name="eleme-share:image" content="'+encodeURI(decodeURI(e.image_url))+'">')},selectHongbao:function(e){return b("selectHongbao",e,null)},selectCoupon:function(e){return b("selectCoupon",String(e))},networkType:function(){return b("networkType")},setTitle:function(e){return document.title=e,b("setTitle",e)},closePage:function(){return b("closePage")},exitConfirm:function(e){return b("exitConfirm",e)},getUserID:function(e){return b("getUserID")},checkPackages:function(e){return b("checkPackages")},openPackage:function(e){return b("openPackage",e)},scanCode:function(e){return void 0===e&&(e={}),b("scanCode",e)},setRightMenu:function(e){var t=[];return e.forEach(function(e){var n=e.eventName;"function"==typeof C[n]&&R("remove",n),C[n]=function(){setTimeout(e.action,0)},R("add",n),t.push({title:e.text,iconHash:e.iconHash,overflow:!!e.overflow,eventName:n})}),b("showRightBarItems",t)},clearRightMenu:function(){return Object.keys(C).forEach(function(e){R("remove",e),delete C[e]}),b("removeRightBarItems")},hookBack:function(e){var t=e.eventName,n=e.action;if("function"==typeof n)return"function"==typeof k[t]&&L("remove",t),k[t]=function(e){setTimeout(function(){n(e&&e.detail)},0)},L("add",t),b("hookGoback",t)},cancelHookBack:function(){return Object.keys(k).forEach(function(e){L("remove",e),delete k[e]}),b("hookGoback",null)},shouldShowNewRetailRedBadge:function(){return b("shouldShowNewRetailRedBadge")},pay:function(e){return new Promise(function(t,n){(!/eleme/i.test(navigator.userAgent)||P("7.8")||O())&&n({name:"NOT_SUPPORT"});var r=e.eventName,i=(e.action,e.merchantId),o=e.merchantOrderNo,a=e.xShard;r=r||"NATIVE_PAY_CALLBACk",document.addEventListener(r,function(e){var r=e.detail,i={};i.merchantId=r.merchant_id,i.merchantOrderNo=r.merchant_order_no,i.status=r.status,"success"===r.status?t(i):n({name:r.status.toUpperCase(),data:i})},!1);var c="merchant_id="+i+"&merchant_order_no="+o+"&event_name="+r,u="eleme://pay?"+c+"&return_url="+encodeURIComponent("eleme://web_pay_result?"+c);a&&(u+="&x_shard="+a),location.href=u})},getTopBarHeight:function(){return b("defaultHeightOfTopBar").then(B)},contactList:function(e){return new Promise(function(t,n){if(/Android/i.test(navigator.userAgent))return n({name:"NOT_SUPPORT"});b("contactList",e).then(function(e){"string"==typeof e?n({name:"PERMISSION_DENIED",data:e}):t(e)})})},setNav:function(e){var t=e.type,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(n[r]=e[r]);return n}(e,["type"]);t in T&&(n=I({},T[t],n));var r=n.immersive,i=n.statusText,o=n.navBg,a=n.navText,c=n.triggerHeight;return void 0!==r&&(b("setImmersiveMode",r),r&&void 0===o&&(o={from:"#00ffffff",to:N})),void 0!==i&&b("setLightStatusBar",{solid:"white"===i}),void 0!==o&&b("setNavBgColor",H(o)),void 0!==a&&b("setNavTextColor",H(a)),void 0!==c&&b("setTriggerHeight",c),Promise.resolve()},sharePanel:function(e){var t={weixin:{key:"weixin_session",value:0},weixin_timeline:{key:"weixin_timeline",value:1},weibo:{key:"weibo",value:2},qq:{key:"qq_session",value:4},qzone:{key:"qzone_session",value:5},weapp:{key:"weapp",value:7}},n={source:"",title:"饿了么",text:"",url:location.href,media:"",targets:Object.keys(t)},r={},i=(e=I(n,e)).url+(/\?|#/.test(e.url)?"&":"?"),o=e.targets.indexOf("clipboard");return-1!==o&&(r.clipboard="eleme://copy?text="+encodeURIComponent(e.url),e.targets.splice(o,1)),e.targets.forEach(function(n){var o=t[n];r[o.key]="eleme://share?"+y({type:o.value,title:e.title,text:e.text,url:i+"type="+n,image_url:encodeURI(decodeURI(e.image_url)),image_only:e.image_only?1:0,media:e.media}),"weapp"===n&&(r[o.key]="eleme://share?"+y({type:7,weapp_id:e.weapp_id,path:e.weapp_path,title:e.title,image_url:e.image_url,url:e.url||""}))}),e.weixin_timeline_image&&(r.weixin_timeline="eleme://share?"+y({type:1,image_url:encodeURI(decodeURI(e.weixin_timeline_image)),image_only:1})),location.href="eleme://sns_share?source="+e.source+"&"+y(r),Promise.resolve()},cart:U,localPush:function(e){var t=e.trigger_at,n=e.title,r=e.content,i=e.icon_base64,o=e.scheme;return new Promise(function(e,a){if(void 0===n)return a(new Error("属性：'title' 不能为空。"));if(void 0===t)return a(new Error("属性：'trigger_at' 不能为空。"));var c=E(t);if(c<E(new Date))return a(new Error("属性：'trigger_at'时间不能小于当前时间。"));b("localPush",{trigger_at:c,title:n,content:r,icon_base64:i,scheme:o}).then(function(t){t?e():a(new Error("可能未开启权限或者参数传送不成功。"))})})},calendar:j,getLocMapImage:function(e){return void 0===e&&(e={}),b("getLocMapImage",e)},getNetwork:function(){return b("getNetwork")},fetch:function(e){return void 0===e&&(e={}),b("fetch",e)},changePageForResult:function(e,t){return void 0===e&&(e={}),b("changePageForResult",e,t)},setPageForResult:function(e){return void 0===e&&(e={}),b("setPageForResult",e)},getPageData:function(){return b("getPageData")},takePhoto:function(e){var t=e.width,n=e.height;return b("takePhoto",{width:t,height:n})},toast:function(e){return void 0===e&&(e={}),b("toast",e)},dialog:function(e){return void 0===e&&(e={}),new Promise(function(t,n){return b("dialog",e).then(function(e){1==e.status?t(e):n(e)})})},loading:function(e){return void 0===e&&(e={}),b("loading",e)},setBounces:function(e){return b("setBounces",e)},cheatInfo:function(){return b("cheatInfo")}},M,J,D,V)});